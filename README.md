# Yuzuriha Rin（楪鈴） - 虚拟角色对话系统

一个基于大语言模型的虚拟角色对话系统，通过智能规则引擎模拟真人发消息的行为模式，包括分段、停顿、错别字、撤回重发等自然对话行为，让AI对话更加生动真实。

## ✨ 功能特点

- 🤖 **多LLM支持** - 支持OpenAI、Anthropic、DeepSeek及自定义OpenAI兼容API
- 💬 **实时对话界面** - 流畅的Web聊天界面，支持微信式分段播放
- ⚙️ **灵活配置** - 可自定义API密钥、模型、角色人设等
- 💾 **本地存储** - 自动保存配置，无需重复输入
- 🇨🇳 **国内优化** - DeepSeek支持，国内访问快速稳定
- 🧠 **消息行为建模** - 智能分段系统，情绪感知的停顿预测
- ✏️ **错别字注入** - 基于情绪的自然错别字模拟和智能撤回
- ↩️ **撤回重发** - 模拟真人发现错误后的撤回行为
- 📊 **情感分析** - LLM驱动的实时情绪检测
- 🎨 **情绪主题** - 根据对话情绪动态调整界面色彩氛围

## 🏗️ 系统架构

```bash
┌─────────────────┐
│   LLM Layer     │  生成对话内容 + 情绪标注
└────────┬────────┘
         │
┌────────▼────────┐
│ Behavior Engine │  消息行为建模（核心特色）
│  ├─ Segmenter   │  - 智能分段算法
│  ├─ Emotion     │  - 情绪检测与映射
│  ├─ Typo        │  - 情绪驱动的错别字注入
│  ├─ Pause       │  - 动态停顿时长计算
│  └─ Coordinator │  - 行为编排与时序控制
└────────┬────────┘
         │
┌────────▼────────┐
│  Frontend UI    │  微信式时间线播放 + 情绪主题
└─────────────────┘
```

## 🛠️ 技术栈

**前端**

- 原生HTML + CSS + JavaScript
- 流畅的消息播放和撤回演示效果

**后端**

- FastAPI - 现代化异步Web框架
- Pydantic - 数据验证和配置管理
- HTTPX - 异步HTTP客户端

**行为引擎**

- 规则驱动的智能分段算法
- 情绪感知的停顿和错别字系统
- 概率模型模拟真实聊天行为
- 时间线编排和动作协调器

## 📦 安装

### 环境要求

- Python 3.10+
- uv 包管理器（推荐）或 pip

## 🚀 快速开始

### 1. 启动后端服务

```bash
# 方式1: 直接运行
python -m src.api.main

# 方式2: 使用uvicorn
uvicorn src.api.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 访问Web界面

打开浏览器访问 `http://localhost:8000`

### 3. 配置LLM

在配置面板中填入：

- **Provider**: 选择 OpenAI/Anthropic/DeepSeek/Custom
  - 🌟 **推荐国内用户**: DeepSeek (快速、便宜、中文好)
- **API Key**: 你的API密钥
- **Model**: 模型名称
  - DeepSeek: `deepseek-chat`
  - OpenAI: `gpt-3.5-turbo`
  - Anthropic: `claude-3-5-sonnet-20241022`
- **角色人设**: 自定义角色性格和说话风格
- **Character Name**: 角色显示名称

### 4. 开始对话

保存配置后即可开始与虚拟角色聊天！

## 📁 项目结构

```bash
Yuzuriha_Rin/
├── src/
│   ├── api/              # FastAPI后端
│   │   ├── main.py       # 应用入口
│   │   ├── routes.py     # API路由
│   │   ├── schemas.py    # Pydantic模型
│   │   └── llm_client.py # LLM客户端
│   ├── behavior/         # 消息行为引擎
│   │   ├── segmenter.py  # 分段模块
│   │   ├── emotion.py    # 情绪检测
│   │   ├── typo.py       # 错别字注入
│   │   ├── pause.py      # 停顿计算
│   │   └── coordinator.py # 行为协调器
│   └── utils/            # 工具函数
├── frontend/             # Web前端
│   ├── index.html
│   ├── chat.js
│   └── styles.css
├── tests/                # 单元测试
└── pyproject.toml        # 项目配置
```

## 🎯 开发路线图

### Phase 1: 基础对话系统 ✅

- [x] FastAPI后端框架
- [x] 多LLM API支持
- [x] Web聊天界面
- [x] 配置管理

### Phase 2: 行为引擎 ✅

- [x] 智能分段模块
- [x] LLM驱动的情绪检测
- [x] 错别字注入逻辑
- [x] 撤回重发系统
- [x] 微信式播放时间线
- [x] 动态停顿计算

### Phase 3: 功能增强（规划中）

- [ ] 多角色对话支持
- [ ] 对话历史管理
- [ ] 角色预设库
- [ ] 更多情绪类型支持
- [ ] 性能优化和调优
- [ ] 移动端适配

## 🔬 核心特色

1. **智能分段** - 基于标点和语义的智能分段算法，模拟真人打字节奏
2. **情绪感知** - LLM生成情绪标注，驱动停顿时长和错别字概率
3. **动态停顿** - 根据情绪状态、文本长度动态计算停顿时间
4. **概率行为** - 错别字和撤回基于概率分布，每次对话略有不同
5. **时间线播放** - send/pause/recall三种动作精确编排，还原真实对话体验
6. **情绪主题** - 界面色彩随情绪变化，提供沉浸式视觉反馈

## 🤝 贡献

这是一个课程项目，暂不接受外部贡献。

## 📄 许可证

MIT License

## 👨‍💻 作者

Leever - AI课程作业项目

---

**Note**: 本项目是一个完整可用的虚拟角色对话系统，采用规则驱动的行为引擎实现自然的对话体验。适合作为学习项目或二次开发的基础。
